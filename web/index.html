<!DOCTYPE html>
<html lang="ko">
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO & Description - AdSense ìŠ¹ì¸ì„ ìœ„í•œ ê³ í’ˆì§ˆ ë©”íƒ€ ì •ë³´ -->
  <meta name="description" content="ì‚¬ì£¼ì™€ MBTIë¥¼ ê²°í•©í•œ ìƒˆë¡œìš´ ìš´ì„¸ ì„œë¹„ìŠ¤. ë‚˜ì˜ 2026ë…„ ìš´ì„¸ë¥¼ ë¬´ë£Œë¡œ í™•ì¸í•˜ì„¸ìš”! íšŒì›ê°€ì… ì—†ì´ 1ë¶„ë§Œì— ê²°ê³¼ í™•ì¸. ì‚¬ì£¼íŒ”ì, í† ì •ë¹„ê²°, ì‹ ë…„ìš´ì„¸ë¥¼ AIê°€ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.">
  <meta name="keywords" content="ìš´ì„¸, ì‚¬ì£¼, MBTI, 2026ìš´ì„¸, ì‹ ë…„ìš´ì„¸, ë¬´ë£Œìš´ì„¸, ì‚¬ì£¼íŒ”ì, í† ì •ë¹„ê²°, AIìš´ì„¸, ì‚¬ì£¼ë¶„ì„, ë³‘ì˜¤ë…„ìš´ì„¸">
  <meta name="author" content="Destiny.OS">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://destiny-os-2026.web.app">

  <!-- Open Graph (Facebook, KakaoTalk) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Destiny.OS - ë‚˜ì˜ 2026ë…„ ìš´ì„¸ëŠ”? ë¬´ë£Œë¡œ í™•ì¸í•˜ê¸°">
  <meta property="og:description" content="ì‚¬ì£¼ Ã— MBTI í•˜ì´ë¸Œë¦¬ë“œ ìš´ì„¸ ğŸ”® íšŒì›ê°€ì… ì—†ì´ ì™„ì „ ë¬´ë£Œ! 1ë¶„ë§Œì— ë‚˜ë§Œì˜ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.">
  <meta property="og:image" content="https://destiny-os-2026.web.app/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://destiny-os-2026.web.app">
  <meta property="og:site_name" content="Destiny.OS">
  <meta property="og:locale" content="ko_KR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Destiny.OS - ë‚˜ì˜ 2026ë…„ ìš´ì„¸ëŠ”? ë¬´ë£Œë¡œ í™•ì¸í•˜ê¸°">
  <meta name="twitter:description" content="ì‚¬ì£¼ Ã— MBTI í•˜ì´ë¸Œë¦¬ë“œ ìš´ì„¸ ğŸ”® íšŒì›ê°€ì… ì—†ì´ ì™„ì „ ë¬´ë£Œ!">
  <meta name="twitter:image" content="https://destiny-os-2026.web.app/og-image.png">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Destiny.OS">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Destiny.OS - ì‚¬ì£¼ Ã— MBTI ìš´ì„¸ | ë¬´ë£Œë¡œ ë‚˜ì˜ 2026ë…„ ìš´ì„¸ í™•ì¸</title>
  <link rel="manifest" href="manifest.json">

  <!-- Google AdSense ìë™ ê´‘ê³  ì½”ë“œ -->
  <!--
    AdSense ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤:
    1. ìë™ ê´‘ê³ ëŠ” ì½˜í…ì¸ ì™€ ì¶©ëŒí•˜ì§€ ì•ŠëŠ” ìµœì  ìœ„ì¹˜ì— ë°°ì¹˜ë¨
    2. ë°˜ì‘í˜• ê´‘ê³ ë¡œ ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ìë™ ëŒ€ì‘
    3. ê¸°ì¡´ ì½˜í…ì¸  ë ˆì´ì•„ì›ƒì„ í•´ì¹˜ì§€ ì•ŠìŒ
    4. ê´‘ê³ ê°€ í‘œì‹œë˜ê¸°ê¹Œì§€ ìµœëŒ€ 1ì‹œê°„ ì†Œìš” ê°€ëŠ¥
  -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9883980748568710"
     crossorigin="anonymous"></script>

  <!-- ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € â†’ ê¸°ë³¸ ë¸Œë¼ìš°ì € ë¦¬ë‹¤ì´ë ‰íŠ¸ -->
  <script>
    (function() {
      'use strict';

      // ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
      function isKakaoInAppBrowser() {
        return /KAKAOTALK/i.test(navigator.userAgent);
      }

      // iOS ê°ì§€
      function isIOS() {
        return /iPad|iPhone|iPod/.test(navigator.userAgent);
      }

      // Android ê°ì§€
      function isAndroid() {
        return /Android/i.test(navigator.userAgent);
      }

      // ë¦¬ë‹¤ì´ë ‰íŠ¸ ìƒíƒœ í™•ì¸ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
      function hasRedirected() {
        return sessionStorage.getItem('kakao_redirected') === 'true';
      }

      // ë¦¬ë‹¤ì´ë ‰íŠ¸ ìƒíƒœ ì €ì¥
      function markAsRedirected() {
        sessionStorage.setItem('kakao_redirected', 'true');
      }

      // Android: Chromeìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      function redirectToChrome() {
        console.log('ğŸ”„ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± â†’ Chrome ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì‘');

        try {
          const currentUrl = window.location.href;
          const intentUrl =
            'intent://' +
            currentUrl.replace(/https?:\/\//i, '') +
            '#Intent;' +
            'scheme=https;' +
            'package=com.android.chrome;' +
            'S.browser_fallback_url=' + encodeURIComponent(currentUrl) +
            ';end';

          markAsRedirected();
          window.location.replace(intentUrl);
        } catch (error) {
          console.error('âŒ Chrome ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹¤íŒ¨:', error);
          showAndroidFallbackMessage();
        }
      }

      // Android: ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹¤íŒ¨ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
      function showAndroidFallbackMessage() {
        const message = document.createElement('div');
        message.style.cssText = `
          position: fixed;
          top: 20px;
          left: 20px;
          right: 20px;
          background: #ff6b6b;
          color: white;
          padding: 15px;
          border-radius: 8px;
          z-index: 99999;
          text-align: center;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
          box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        `;
        message.innerHTML = 'âš ï¸ Chrome ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”';
        document.body.appendChild(message);

        setTimeout(() => message.remove(), 5000);
      }

      // iOS: Safariì—ì„œ ì—´ê¸° ì•ˆë‚´
      function showIOSGuide() {
        console.log('ğŸ“± iOS ì¹´ì¹´ì˜¤í†¡ ì¸ì•±: Safari ì•ˆë‚´ í‘œì‹œ');

        const guide = document.createElement('div');
        guide.id = 'kakao-ios-guide';
        guide.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.85);
          display: flex;
          align-items: flex-end;
          z-index: 99999;
          animation: fadeIn 0.3s ease;
        `;

        guide.innerHTML = `
          <style>
            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            @keyframes slideUp {
              from { transform: translateY(100%); }
              to { transform: translateY(0); }
            }
            #kakao-ios-content {
              animation: slideUp 0.3s ease;
            }
          </style>
          <div id="kakao-ios-content" style="
            width: 100%;
            background: white;
            padding: 24px;
            border-radius: 16px 16px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
          ">
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="font-size: 48px; margin-bottom: 12px;">ğŸŒŸ</div>
              <h3 style="margin: 0 0 8px 0; font-size: 20px; color: #1a1a1a; font-weight: 700;">
                ë” ë‚˜ì€ í™˜ê²½ì—ì„œ ì´ìš©í•˜ì„¸ìš”
              </h3>
              <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
                PWA ì„¤ì¹˜ì™€ ì•Œë¦¼ ê¸°ëŠ¥ì„ ìœ„í•´<br>Safari ë¸Œë¼ìš°ì €ê°€ í•„ìš”í•©ë‹ˆë‹¤
              </p>
            </div>

            <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
              <p style="margin: 0 0 12px 0; color: #495057; font-size: 14px; font-weight: 600;">
                ğŸ“Œ Safariì—ì„œ ì—´ê¸°
              </p>
              <ol style="margin: 0; padding-left: 20px; color: #6c757d; font-size: 14px; line-height: 1.8;">
                <li>í™”ë©´ í•˜ë‹¨ì˜ <strong style="color: #495057;">ê³µìœ  ë²„íŠ¼</strong> (ğŸ“¤) íƒ­</li>
                <li><strong style="color: #495057;">'Safariì—ì„œ ì—´ê¸°'</strong> ì„ íƒ</li>
              </ol>
            </div>

            <button onclick="document.getElementById('kakao-ios-guide').remove(); sessionStorage.setItem('kakao_redirected', 'true');" style="
              width: 100%;
              padding: 16px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 12px;
              font-size: 16px;
              font-weight: 700;
              cursor: pointer;
              box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
              transition: transform 0.2s ease;
            " onmouseover="this.style.transform='scale(0.98)'" onmouseout="this.style.transform='scale(1)'">
              ì•Œê² ìŠµë‹ˆë‹¤
            </button>
          </div>
        `;

        document.body.appendChild(guide);
      }

      // ë©”ì¸ ì‹¤í–‰ ë¡œì§
      function handleKakaoInAppRedirect() {
        // ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì €ê°€ ì•„ë‹ˆë©´ ì‹¤í–‰ ì¤‘ë‹¨
        if (!isKakaoInAppBrowser()) {
          console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ì•„ë‹˜ - ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¶ˆí•„ìš”');
          return;
        }

        // ì´ë¯¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œë„í–ˆìœ¼ë©´ ì¤‘ë‹¨ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
        if (hasRedirected()) {
          console.log('â­ï¸ ì´ë¯¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œë„ë¨ - ìŠ¤í‚µ');
          return;
        }

        console.log('ğŸ” ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ë¨');

        // Android: Intent URIë¡œ Chrome ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (isAndroid()) {
          redirectToChrome();
        }
        // iOS: ì‚¬ìš©ì ì•ˆë‚´ í‘œì‹œ
        else if (isIOS()) {
          showIOSGuide();
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì‹¤í–‰
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', handleKakaoInAppRedirect);
      } else {
        handleKakaoInAppRedirect();
      }
    })();
  </script>

  <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ & í‘¸ì‹œ ì•Œë¦¼ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì €ì¥
    var deferredInstallPrompt = null;
    var isPwaInstalled = false;

    // beforeinstallprompt ì´ë²¤íŠ¸ ìº¡ì²˜
    window.addEventListener('beforeinstallprompt', function(e) {
      console.log('âœ… beforeinstallprompt event fired');
      // ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ë°©ì§€
      e.preventDefault();
      // í”„ë¡¬í”„íŠ¸ ì €ì¥
      deferredInstallPrompt = e;
      // Flutterì— ì•Œë¦¼
      window.dispatchEvent(new CustomEvent('pwaInstallAvailable'));
    });

    // ì•± ì„¤ì¹˜ ì™„ë£Œ ì´ë²¤íŠ¸
    window.addEventListener('appinstalled', function() {
      console.log('âœ… PWA was installed');
      isPwaInstalled = true;
      deferredInstallPrompt = null;
    });

    // Flutterì—ì„œ í˜¸ì¶œí•˜ëŠ” ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ íŠ¸ë¦¬ê±° í•¨ìˆ˜
    async function triggerInstallPrompt() {
      if (!deferredInstallPrompt) {
        console.log('âš ï¸ No install prompt available');
        return null;
      }

      try {
        // í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        deferredInstallPrompt.prompt();
        // ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
        const result = await deferredInstallPrompt.userChoice;
        console.log('ğŸ“± User choice:', result.outcome);
        
        // í”„ë¡¬í”„íŠ¸ëŠ” í•œ ë²ˆë§Œ ì‚¬ìš© ê°€ëŠ¥
        if (result.outcome === 'accepted') {
          deferredInstallPrompt = null;
        }
        
        return result;
      } catch (error) {
        console.error('âŒ Install prompt error:', error);
        return null;
      }
    }

    // ì›¹ í‘¸ì‹œ ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
    async function requestNotificationPermission() {
      if (!('Notification' in window)) {
        console.log('âš ï¸ This browser does not support notifications');
        return 'unsupported';
      }

      if (Notification.permission === 'granted') {
        console.log('âœ… Notification permission already granted');
        return 'granted';
      }

      if (Notification.permission === 'denied') {
        console.log('âŒ Notification permission was denied');
        return 'denied';
      }

      try {
        const permission = await Notification.requestPermission();
        console.log('ğŸ“± Notification permission:', permission);
        return permission;
      } catch (error) {
        console.error('âŒ Notification permission error:', error);
        return 'error';
      }
    }

    // ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ í‘¸ì‹œ ì•Œë¦¼ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
    function isPushSupported() {
      return 'serviceWorker' in navigator && 'PushManager' in window;
    }

    // Standalone ëª¨ë“œ í™•ì¸ (ì´ë¯¸ ì„¤ì¹˜ëœ ì•±)
    function isRunningStandalone() {
      return window.matchMedia('(display-mode: standalone)').matches ||
             window.matchMedia('(display-mode: fullscreen)').matches ||
             window.navigator.standalone === true;
    }

    // ì´ˆê¸°í™” ì‹œ standalone ëª¨ë“œ í™•ì¸
    if (isRunningStandalone()) {
      isPwaInstalled = true;
      console.log('âœ… Running in standalone mode (PWA installed)');
    }
  </script>
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
