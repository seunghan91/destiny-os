# Destiny.OS - 기능 명세서

## 1. 사주 분석 시스템

### 1.1 사주팔자 계산 (Four Pillars)

#### 입력 정보
```yaml
required:
  - birth_date: DateTime (양력)
  - gender: enum [male, female]

optional:
  - birth_time: Time (시간 모르면 null)
  - is_lunar: bool (음력 입력 여부)
  - birth_location: LatLng (경도 보정용)
```

#### 출력 정보
```yaml
saju_chart:
  year_pillar:  # 년주
    heavenly_stem: 천간 (甲~癸)
    earthly_branch: 지지 (子~亥)
  month_pillar: # 월주
    heavenly_stem: 천간
    earthly_branch: 지지
  day_pillar:   # 일주 (핵심)
    heavenly_stem: 천간 (일간 = Day Master)
    earthly_branch: 지지
  hour_pillar:  # 시주 (시간 있을 때만)
    heavenly_stem: 천간
    earthly_branch: 지지
```

#### 핵심 알고리즘
1. **양력 → 음력 변환**: 24절기 기준 월 계산
2. **60갑자 매핑**: 천간(10) x 지지(12) 조합
3. **경도 보정**: 출생지 경도 → 진태양시 변환
4. **야자시 처리**: 23:00~24:00 옵션 제공

---

### 1.2 십성(Ten Gods) 분석

일간(Day Master)을 기준으로 다른 천간/지지와의 관계 도출

| 십성 | 한자 | 의미 | MBTI 매핑 |
|------|------|------|-----------|
| 비견 | 比肩 | 동료, 경쟁 | E 성향 |
| 겁재 | 劫財 | 공격적 자아 | E + 주도성 |
| 식신 | 食神 | 창의, 표현 | N + P 성향 |
| 상관 | 傷官 | 반항, 혁신 | ENTP 기질 |
| 편재 | 偏財 | 사업, 모험 | E + T 성향 |
| 정재 | 正財 | 꼼꼼, 안정 | S + J 성향 |
| 편관 | 偏官 | 카리스마, 권력 | ENTJ 기질 |
| 정관 | 正官 | 규율, 질서 | ISTJ/ESTJ |
| 편인 | 偏印 | 의심, 통찰 | INTP/INTJ |
| 정인 | 正印 | 수용, 학습 | ISFJ 기질 |

---

### 1.3 MBTI 연동 (Gap Analysis)

#### 입력
```yaml
user_mbti: string # "ENFP", "ISTJ" 등 16개 유형
```

#### 분석 프로세스
1. 사주 기반 **잠재적 MBTI** 산출
2. 사용자 입력 MBTI와 비교
3. **괴리도(Gap Score)** 계산
4. 인사이트 텍스트 생성

#### 인사이트 예시
```
Gap이 큰 경우:
"당신은 현재 평화로운 예술가(ISFP)로 살고 있지만,
내면 깊은 곳에는 세상을 호령하고 싶은 장군(ENTJ)의
칼이 숨겨져 있습니다."

Gap이 작은 경우:
"당신은 타고난 대로 자신을 잘 표현하고 있습니다.
본능에 충실하세요."
```

---

## 2. 2026년 운세 (병오년 火馬)

### 2.1 연간 총운

#### 병오년 특성
- 천간: 丙 (양의 불)
- 지지: 午 (말, 불)
- 키워드: 폭발적 에너지, 가시성, 급격한 변화

#### 용신별 해석
```yaml
fire_favorable:  # 화(火)가 용신인 경우
  title: "2026년은 당신의 무대입니다"
  description: "물 들어올 때 노 저으세요. 불장(Bull Market)입니다."
  action: "도전, 확장, 가시화"

fire_unfavorable:  # 화(火)가 기신인 경우
  title: "과열 주의보 발령"
  description: "성급한 투자는 금물입니다. 멘탈의 냉각수가 필요합니다."
  action: "휴식, 신중, 내실"
```

### 2.2 월별 에너지 차트

| 월 | 지지 | 화(火) 에너지 | 주의사항 |
|----|------|---------------|----------|
| 1월 | 寅 | 40 | 시작의 기운 |
| 2월 | 卯 | 50 | 성장 준비 |
| 3월 | 辰 | 60 | 상승세 |
| 4월 | 巳 | 90 | **피크 시작** |
| 5월 | 午 | **110** | **연중 최고조** |
| 6월 | 未 | 100 | 열정 유지 |
| 7월 | 申 | 70 | 조정기 |
| 8월 | 酉 | 60 | 정리 |
| 9월 | 戌 | 55 | 안정 |
| 10월 | 亥 | 45 | 휴식기 |
| 11월 | 子 | **25** | **자오충 주의** |
| 12월 | 丑 | 30 | 마무리 |

---

## 3. 대운(Daewoon) 타임라인

### 3.1 대운 계산

- 10년 단위로 변화하는 인생의 큰 계절
- 성별 + 년주 음양에 따라 순행/역행 결정
- 대운 시작 나이 계산

### 3.2 대운 키워드 매핑

| 대운 십성 | 키워드 | 설명 |
|----------|--------|------|
| 비겁 대운 | 자립과 경쟁 | 독립심 강화, 형제/동료 이슈 |
| 식상 대운 | 창작과 표현 | 예술, 자녀, 아이디어 활발 |
| 재성 대운 | 재물과 확장 | 사업, 투자, 결혼 적기 |
| 관성 대운 | 명예와 책임 | 승진, 인정, 압박감 |
| 인성 대운 | 학습과 수용 | 자격증, 공부, 부모 이슈 |

### 3.3 UI 표현
- 가로 스크롤 타임라인
- 현재 대운 하이라이트
- 클릭 시 상세 팝업 카드

---

## 4. 궁합 분석

### 4.1 궁합 유형
- 연인 궁합
- 친구/동료 궁합
- 부모-자녀 궁합

### 4.2 분석 요소

#### 일주 궁합
```yaml
combination_types:
  - 합(合): 서로 끌림, 조화
  - 충(沖): 충돌, 긴장감
  - 형(刑): 갈등, 자극
  - 파(破): 깨짐, 불안정
  - 해(害): 해침, 방해
```

#### 조후(Temperature) 궁합
- 화(火) 많은 사람 + 수(水) 많은 사람 = 상호 보완
- 같은 오행 과다 = 과열/과냉 주의

#### MBTI 크로스체크
- 상대 MBTI와 나의 사주 십성 호환성 분석

### 4.3 결과 표현

```yaml
compatibility_score: 78  # 0-100
relationship_type: "브레이크 없는 스포츠카"
strengths:
  - "추진력 최고"
  - "서로의 열정 자극"
cautions:
  - "충돌 위험 높음"
  - "재무 관리 필요"
recommendations:
  - "재무 관리는 ISTJ 성향인 OOO님이 맡으세요"
```

---

## 5. AI 상담 기능

### 5.1 무료 제공
- 회원당 1회 무료 AI 상담
- 사주 분석 결과 기반 개인화 질문

### 5.2 상담 유형
```yaml
consultation_types:
  - career: "직업/진로 상담"
  - relationship: "연애/결혼 상담"
  - finance: "재물/투자 상담"
  - health: "건강/웰빙 상담"
  - general: "종합 상담"
```

### 5.3 AI 프롬프트 구조
```
[시스템 프롬프트]
당신은 사주명리학과 MBTI 전문 상담사입니다.
사용자의 사주 정보와 MBTI를 바탕으로 따뜻하고
실용적인 조언을 제공합니다.

[사용자 컨텍스트]
- 사주팔자: {사주 데이터}
- MBTI: {mbti}
- 2026년 운세: {fortune_summary}
- 상담 유형: {consultation_type}

[사용자 질문]
{user_question}
```

---

## 6. 공유 기능

### 6.1 공유 카드 생성
- RepaintBoundary로 위젯 → 이미지 변환
- 9:16 비율 (인스타 스토리 최적화)
- 토스 디자인 시스템 적용

### 6.2 공유 채널
- 인스타그램 스토리
- 카카오톡
- 이미지 저장

### 6.3 바이럴 요소
```yaml
shareable_content:
  - 2026년 운세 카드
  - 사주-MBTI Gap 분석 결과
  - 궁합 점수 카드
  - 대운 타임라인 스냅샷
```

---

## 7. 설정 및 기타

### 7.1 사용자 설정
- 야자시 적용 여부 토글
- 알림 설정
- 데이터 초기화 (개인정보 삭제)

### 7.2 개인정보 처리
- 생년월일 로컬 저장 기본
- 서버 저장 시 명시적 동의
- 데이터 삭제권 보장

### 7.3 각주 및 면책
- "운세는 참고용이며 과학적으로 검증된 것이 아닙니다"
- "23시~00시 출생자는 학파에 따라 결과가 다를 수 있습니다"
