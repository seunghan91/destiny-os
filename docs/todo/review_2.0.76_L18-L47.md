## 검토 대상

- **@2.0.76 (L18–L47)**에서 확정/가정된 항목
  - **프레임워크**: Flutter (기획서 권장)
  - **배포 타겟**: 1, 2 (정의 필요)
  - **MVP 범위**: 3 + 추가상담(AI 프롬프트 1회 제공)
  - **백엔드**: Serverless (Firebase/Supabase)

## 기획서 관점에서의 정합성 체크 (요약)

- **Flutter 선택은 정합**: 기획서에 Flutter + BLoC + Clean Architecture 기반의 안정성/확장성 전략이 명시돼 있습니다.
- **핵심 연산은 “클라이언트 중심”이 기본값**: 만세력/절기/진태양시 보정 등 정확도 핵심은 외부 API 의존도를 줄이고 앱에서 처리하는 방향으로 서술되어 있습니다.
- **개인정보(생년월일시) 처리는 “서버 최소화”가 맞음**: 기획서에 서버 저장 최소화/명시적 동의/삭제권이 포함됩니다. 즉, 백엔드는 “필요 최소(결제/AI/로그 등)”로 범위를 좁혀 정의하는 게 설계상 깔끔합니다.

## 현재 결정에서 빠진(혹은 정의가 애매한) 핵심 결정 포인트

### 배포 타겟 “1,2”의 정확한 의미

- **질문**: 1,2가 정확히 무엇인가요?
  - 예: (A) iOS/Android 네이티브 앱, (B) 토스 앱 내 미니앱(웹뷰/SDK 기반), (C) 둘 다
- **왜 중요?**
  - “토스 미니앱”이 **Flutter 런타임을 허용하는지**(또는 Flutter Web/다른 형태인지)에 따라 전체 기술 스택이 갈립니다.

### MVP 범위 “3”의 정의

- **질문**: “3”이 의미하는 기능 묶음이 무엇인가요? (기획서의 번호/섹션 기준인지, 내부 우선순위인지)
- **권장 산출물**: MVP 기능을 “화면/입력/출력/공유/설정/과금” 단위로 쪼개서 체크리스트화해야 개발 견적이 안정화됩니다.

### AI 1회 상담의 구현 방식

- **결정 필요**
  - **LLM 호출 위치**: 클라이언트 직접 호출 vs 서버리스 함수(권장)
  - **프롬프트에 포함할 데이터 범위**: 생년월일시 원문을 보낼지, **파생된 사주/MBTI 피처(십성/오행/대운/갭 분석 결과 등)**만 보낼지
  - **비용/남용 방지**: 1회 제공을 어떻게 증빙/차감할지(익명 사용자라도 재발급/리셋 방지 필요)

### 개인정보/클레임 방지 옵션(기획서 blind spots)

- **필수로 결정해야 하는 UX 정책**
  - **명시적 동의**: 언제/어떤 문구로 받을지
  - **데이터 삭제권**: “데이터 초기화” 범위(로컬만/서버 포함 여부)
  - **야자시(23:00~00:00) 처리**: 기본값(현대적 00시 기준 vs 토글 제공)과 결과 화면 각주 정책
  - **출생지/경도 보정**: 출생지(도시) 입력을 받을지, 최소화할지(정확도 vs 마찰)

## 백엔드(Serverless) 선택 가이드 (Firebase vs Supabase)

### 공통 권장 방향(특히 MVP)

- **“상태 최소화(stateless)” 서버리스부터 시작**:
  - 우선은 “AI 상담 1회 실행” 같은 **단일 기능 API**만 서버로 두고,
  - 생년월일시 등 민감 데이터는 **기본적으로 로컬 Secure Storage에만 저장**(기획서 방향과 일치).

### Firebase가 유리한 경우

- Flutter에서 빠른 통합(인증/푸시/분석), 운영 경험이 많을 때
- 최소 기능(익명 로그인 + 클라우드 함수)로 빠르게 MVP를 뽑고 싶을 때

### Supabase가 유리한 경우

- “사용자별 결과 히스토리/과금 이력/상담 로그”를 **SQL로 명확히 관리**하고 싶을 때
- RLS 기반 권한 모델을 선호할 때
- Edge Functions로 API만 가볍게 운영하면서 DB는 필요 시 확장하고 싶을 때

## 추천 “결정안 초안”(바로 실행 가능한 형태)

- **프론트**: Flutter + BLoC + Clean Architecture(기획서 기준)
- **연산**: 만세력/절기/윤달/진태양시 보정은 클라이언트 처리(정확도 핵심)
- **백엔드(MVP)**: 서버리스 함수 1개부터 시작
  - 역할: “AI 추가상담 1회 실행” + rate limit + (선택) 1회권 차감 저장
  - 프롬프트: 생년월일시 원문 대신 파생 피처를 우선 사용(개인정보 최소화)

## 사용자에게 확인이 필요한 질문(결정만 해주시면 다음 문서로 바로 구체화 가능)

1) **배포 타겟 “1,2”가 정확히 무엇인지**(iOS/Android, 토스 미니앱, 둘 다 등)
2) **MVP의 “3”이 의미하는 기능 묶음**(기획서 번호 기준이면 해당 섹션명/기능명)
3) **백엔드 우선순위**: MVP에서 정말 필요한 서버 기능은 “AI 1회 상담”만인가요, 아니면
   - 결과 히스토리(서버 저장),
   - 결제/영수증 검증,
   - 이벤트/분석 로그
   도 포함인가요?
4) **AI 데이터 정책**: LLM에 생년월일시를 보내는 것에 대해 허용/비허용(권장: 비허용, 파생 피처만 전송)
5) **야자시 기본값**: 토글 제공(권장) vs 각주만 vs 단일 기준 고정

